#!/bin/bash

DIR="$(dirname "$0")"
. "${DIR}/config"


go mod tidy
go mod vendor

# worker
docker build -f Dockerfile.worker \
    -t "gcr.io/${PROJECT_ID}/${APP_NAME}:${IMAGE_VERSION}" .
docker push "gcr.io/${PROJECT_ID}/${APP_NAME}:${IMAGE_VERSION}"

# worker
docker build -f Dockerfile.cli \
    -t "gcr.io/${PROJECT_ID}/${APP_NAME}-cli:${IMAGE_VERSION}" .
docker push "gcr.io/${PROJECT_ID}/${APP_NAME}-cli:${IMAGE_VERSION}"
