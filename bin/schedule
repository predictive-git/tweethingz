#!/bin/bash

DIR="$(dirname "$0")"
. "${DIR}/config"


SERVICE_URL=$(gcloud beta run services describe ${SERVICE_NAME} \
    --region ${SERVICE_REGION} --format="value(status.domain)")

SERVICE_TOKEN=$(<"${CONF_DIR}/service_token")

for TW_USER in "${SCHEDULE_ACCOUNTS[@]}"
do
    gcloud scheduler jobs create http "${SERVICE_NAME}-refresh-${TW_USER}" \
        --http-method POST \
        --schedule "${SCHEDULE_FREQUENCY}" \
        --uri "${SERVICE_URL}/api/v1/refresh/${TW_USER}?token=${SERVICE_TOKEN}"

    gcloud scheduler jobs describe "${SERVICE_NAME}-refresh-${TW_USER}"
done